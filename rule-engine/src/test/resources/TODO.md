# FEATURE

1. ListenerEvent.failure 的拓扑以及trace测试用例
2. if() 的trace以及拓扑测试用例
3. 规则引擎线程的拒绝策略要做限制
4. 拦截器是否执行到的测试用例
5. DefaultRuleEngine的构造方法
6. @ActionBean等注解，增加ruleEngine过滤，根据匹配结果注册到不同的ruleEngine实例中去
7. 增加SerializeWriter的测试用例
8. 解析ClusterConfig时，校验self的ip是否为本机网卡的ip
9. 时钟同步
10. 当一个节点被误判inactive后，如何恢复

# README

1. 监听的行为，是否会相互影响
2. 监听的执行时机，global执行次数，如何执行，是否会merge所有的变量


# 高可用

__要解决的问题__

1. 灰度发布时，由于重启导致的规则执行中断的问题，需要在另一台机器上重新执行
1. 集群中的节点如何感知其他节点的存在
1. 一致性问题

## 集群感知

一般而言，做法有如下几种

1. 静态配置，这种方式下，需要事先知道节点的ip，当动态缩容、扩容时，需要动态调整配置，较为不便，但实现简单
1. 种子节点（类似akka-cluster），通过一个种子节点接入集群，言下之意需要配置种子节点（单个或一组），但是可以实现缩容扩容，实现难度同第一种方式
1. 注册中心，需要配置注册中心的地址，且需要适配不同的注册中心实现（redis，zookeeper等），可以动态实现缩容扩容，实现较为复杂

最后选择：种子节点

1. 种子节点可以看做一个小集群，相互有心跳感知
1. 每个普通节点和某一个种子节点保持心跳
1. 普通节点加入集群时，遍历种子节点，直到加入集群
1. 普通节点与种子节点之间的心跳断开后，需要将集群状态推送到所有节点，这里涉及到分布式一致性问题
1. 普通节点只能被动感知集群变化
1. 除了接入功能外，种子节点也可以作为普通节点使用
1. 种子节点需要感知的状态
    * 哪个普通节点和哪个种子节点之间有心跳
    * 集群中处于存活状态的节点列表
1. 心跳
    * 两个种子节点之间需要几个心跳？1个还是2个？
    * 心跳抢占，如果两个种子节点或多个种子节点同时向一个普通节点发起心跳连接，那么该普通节点需要任意接受一个连接，拒绝其他连接
1. 类似akka，节点的生命周期（active，removed，等等这些状态）
1. 种子集群也需要leader，所有的状态更新由leader发起（从这个角度来避免竞争），换言之，需要进行选举
1. 连通图
    * 普通节点只跟种子节点连
    * 种子节点之间有连
1. seed1和seed2同时启动，启动的时候都发现其他seed尚未存活，这个时候如何恢复（不恢复的话会形成两个孤岛）

状态图：https://doc.akka.io/docs/akka/current/common/cluster.html#membership

为了便于测试，需要将单例模式改成实例模式

# 分布式问题
