package org.liuyehcf.compile.engine.hua.test;

import org.junit.Test;
import org.liuyehcf.compile.engine.core.CompileResult;
import org.liuyehcf.compile.engine.hua.core.IntermediateInfo;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;
import static org.liuyehcf.compile.engine.hua.test.TestGrammar.getCompiler;

/**
 * @author chenlu
 * @date 2018/7/1
 */
public class TestImplicitTypeConversion {

    @Test
    public void testIntCompatibleTypeConversion() {
        String text = "void func() {\n" +
                "\tint a = '1';\n" +
                "\ta*='1';a='1'*'1';a=1*'1';a='1'*1;\n" +
                "\ta/='1';a='1'/'1';a=1/'1';a='1'/1;\n" +
                "\ta%='1';a='1'%'1';a=1%'1';a='1'%1;\n" +
                "\ta+='1';a='1'+'1';a=1+'1';a='1'+1;\n" +
                "\ta-='1';a='1'-'1';a=1-'1';a='1'-1;\n" +
                "\ta<<='1';a='1'<<'1';a=1<<'1';a='1'<<1;\n" +
                "\ta>>='1';a='1'>>'1';a=1>>'1';a='1'>>1;\n" +
                "\ta>>>='1';a='1'>>>'1';a=1>>>'1';a='1'>>>1;\n" +
                "\ta&='1';a='1'&'1';a=1&'1';a='1'&1;\n" +
                "\ta^='1';a='1'^'1';a=1^'1';a='1'^1;\n" +
                "\ta|='1';a='1'|'1';a=1|'1';a='1'|1;\n" +
                "}\n";

        System.out.println(text);

        CompileResult<IntermediateInfo> result = getCompiler().compile(text);
        assertTrue(result.isSuccess());
        assertEquals(
                "{\"func()\":[{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_imul\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_imul\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_imul\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_imul\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_idiv\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_idiv\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_idiv\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_idiv\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_irem\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_irem\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_irem\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_irem\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iadd\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iadd\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iadd\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iadd\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_isub\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_isub\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_isub\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_isub\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ishl\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ishl\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ishl\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ishl\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ishr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ishr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ishr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ishr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iushr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iushr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iushr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iushr\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iand\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iand\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iand\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iand\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ixor\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ixor\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ixor\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ixor\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ior\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ior\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ior\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ior\"},{\"name\":\"_istore\",\"order\":0},{\"name\":\"_return\"}]}",
                result.getResult().getMethodInfoTable().toSimpleJSONString()
        );
    }

    @Test
    public void testLongCompatibleTypeConversion() {
        String text = "void  func() {\n" +
                "\tlong a = '1';\n" +
                "\ta*='1';a*=1;a=a*'1';a='1'*a;a=a*1;a=1*a;\n" +
                "\ta/='1';a/=1;a=a/'1';a='1'/(a+1);a=a/1;a=1/(a+1);\n" +
                "\ta%='1';a%=1;a=a%'1';a='1'%(a+1);a=a%1;a=1%(a+1);\n" +
                "\ta+='1';a+=1;a=a+'1';a='1'+a;a=a+1;a=1+a;\n" +
                "\ta-='1';a-=1;a=a-'1';a='1'-a;a=a-1;a=1-a;\n" +
                "\ta<<='1';a<<=1;a=a<<'1';a='1'<<a;a=a<<1;a=1<<a;\n" +
                "\ta>>='1';a>>=1;a=a>>'1';a='1'>>a;a=a>>1;a=1>>a;\n" +
                "\ta>>>='1';a>>>=1;a=a>>>'1';a='1'>>>a;a=a>>>1;a=1>>>a;\n" +
                "\ta&='1';a&=1;a=a&'1';a='1'&a;a=a&1;a=1&a;\n" +
                "\ta^='1';a^=1;a=a^'1';a='1'^a;a=a^1;a=1^a;\n" +
                "\ta|='1';a|=1;a=a|'1';a='1'|a;a=a|1;a=1|a;\n" +
                "}";

        System.out.println(text);

        CompileResult<IntermediateInfo> result = getCompiler().compile(text);
        assertTrue(result.isSuccess());
        assertEquals(
                "{\"func()\":[{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lmul\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lmul\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lmul\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lmul\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lmul\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lmul\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ldiv\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ldiv\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ldiv\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ladd\"},{\"name\":\"_ldiv\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ldiv\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ladd\"},{\"name\":\"_ldiv\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lrem\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lrem\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lrem\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ladd\"},{\"name\":\"_lrem\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lrem\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ladd\"},{\"name\":\"_lrem\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ladd\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ladd\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ladd\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_ladd\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ladd\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_ladd\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lsub\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lsub\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lsub\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lsub\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lsub\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lsub\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lshl\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lshl\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lshl\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lshl\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lshl\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lshl\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lshr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lshr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lshr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lshr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lshr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lshr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lushr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lushr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lushr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lushr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lushr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lushr\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_land\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_land\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_land\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_land\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_land\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_land\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lxor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lxor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lxor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lxor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lxor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lxor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_lload\",\"order\":0},{\"name\":\"_lor\"},{\"name\":\"_lstore\",\"order\":0},{\"name\":\"_return\"}]}",
                result.getResult().getMethodInfoTable().toSimpleJSONString()
        );
    }

    @Test
    public void testFloatCompatibleTypeConversion() {
        String text = "void  func() {\n" +
                "\tfloat a = '1';\n" +
                "\ta*='1';a*=1;a*=1L;a=a*'1';a='1'*a;a=a*1;a=1*a;a=a*1L;a=1L*a;\n" +
                "\ta/='1';a/=1;a/=1L;a=a/'1';a='1'/(a+1);a=a/1;a=1/(a+1);a=a/1L;a=1L/(a+1);\n" +
                "\ta%='1';a%=1;a%=1L;a=a%'1';a='1'%a;a=a%1;a=1%a;a=a%1L;a=1L%a;\n" +
                "\ta+='1';a+=1;a+=1L;a=a+'1';a='1'+a;a=a+1;a=1+a;a=a+1L;a=1L+a;\n" +
                "\ta-='1';a-=1;a-=1L;a=a-'1';a='1'-a;a=a-1;a=1-a;a=a-1L;a=1L-a;\n" +
                "}";

        System.out.println(text);

        CompileResult<IntermediateInfo> result = getCompiler().compile(text);
        assertTrue(result.isSuccess());
        assertEquals(
                "{\"func()\":[{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fmul\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fdiv\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_frem\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fadd\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_fload\",\"order\":0},{\"name\":\"_fsub\"},{\"name\":\"_fstore\",\"order\":0},{\"name\":\"_return\"}]}",
                result.getResult().getMethodInfoTable().toSimpleJSONString()
        );
    }

    @Test
    public void testDoubleCompatibleTypeConversion() {
        String text = "void  func() {\n" +
                "\tdouble a = '1';\n" +
                "\ta*='1';a*=1;a*=1L;a*=1.1f;a=a*'1';a='1'*a;a=a*1;a=1*a;a=a*1L;a=1L*a;a=a*1.1f;a=1.1f*a;\n" +
                "\ta/='1';a/=1;a/=1L;a/=1.1f;a=a/'1';a='1'/a;a=a/1;a=1/a;a=a/1L;a=1L/a;a=a/1.1f;a=1.1f/a;\n" +
                "\ta%='1';a%=1;a%=1L;a%=1.1f;a=a%'1';a='1'%a;a=a%1;a=1%a;a=a%1L;a=1L%a;a=a%1.1f;a=1.1f%a;\n" +
                "\ta+='1';a+=1;a+=1L;a+=1.1f;a=a+'1';a='1'+a;a=a+1;a=1+a;a=a+1L;a=1L+a;a=a+1.1f;a=1.1f+a;\n" +
                "\ta-='1';a-=1;a-=1L;a-=1.1f;a=a-'1';a='1'-a;a=a-1;a=1-a;a=a-1L;a=1L-a;a=a-1.1f;a=1.1f-a;\n" +
                "}";

        System.out.println(text);

        CompileResult<IntermediateInfo> result = getCompiler().compile(text);
        assertTrue(result.isSuccess());
        assertEquals(
                "{\"func()\":[{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dmul\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_ddiv\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_drem\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dadd\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":49},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_iconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_lconst\",\"value\":1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_fconst\",\"value\":1.1},{\"name\":\"_dload\",\"order\":0},{\"name\":\"_dsub\"},{\"name\":\"_dstore\",\"order\":0},{\"name\":\"_return\"}]}",
                result.getResult().getMethodInfoTable().toSimpleJSONString()
        );
    }


}
